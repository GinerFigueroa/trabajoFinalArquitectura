CREATE TABLE `informes_financieros` (
  `id_informe` int(11) NOT NULL AUTO_INCREMENT,
  `titulo` varchar(255) NOT NULL,
  `tipo` enum('INGRESOS','GASTOS','BALANCE','FLUJO_EFECTIVO','PERSONALIZADO') NOT NULL,
  `fecha_inicio` date NOT NULL,
  `fecha_fin` date NOT NULL,
  `filtros` json DEFAULT NULL,
  `datos` json NOT NULL,
  `id_usuario` int(11) NOT NULL,
  `estado` enum('PENDIENTE','GENERADO','ERROR') DEFAULT 'PENDIENTE',
  `creado_en` timestamp NOT NULL DEFAULT current_timestamp(),
  `actualizado_en` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id_informe`),
  KEY `id_usuario` (`id_usuario`),
  KEY `idx_tipo_fechas` (`tipo`,`fecha_inicio`,`fecha_fin`),
  CONSTRAINT `informes_financieros_ibfk_1` FOREIGN KEY (`id_usuario`) REFERENCES `usuarios` (`id_usuario`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish2_ci;


CREATE TABLE `config_reportes_financieros` (
  `id_config` int(11) NOT NULL AUTO_INCREMENT,
  `nombre` varchar(100) NOT NULL,
  `tipo_reporte` enum('DIARIO','SEMANAL','MENSUAL','TRIMESTRAL','ANUAL') NOT NULL,
  `parametros` json NOT NULL,
  `formato_salida` enum('PDF','EXCEL','HTML','JSON') DEFAULT 'PDF',
  `programado` tinyint(1) DEFAULT 0,
  `frecuencia` varchar(50) DEFAULT NULL,
  `activo` tinyint(1) DEFAULT 1,
  `id_usuario` int(11) NOT NULL,
  `creado_en` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id_config`),
  KEY `id_usuario` (`id_usuario`),
  CONSTRAINT `config_reportes_financieros_ibfk_1` FOREIGN KEY (`id_usuario`) REFERENCES `usuarios` (`id_usuario`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish2_ci;




CREATE TABLE `metricas_financieras` (
  `id_metrica` int(11) NOT NULL AUTO_INCREMENT,
  `fecha` date NOT NULL,
  `tipo_metrica` enum('INGRESOS','GASTOS','UTILIDAD','PACIENTES','PROCEDIMIENTOS') NOT NULL,
  `categoria` varchar(100) NOT NULL,
  `valor` decimal(15,2) NOT NULL,
  `meta` decimal(15,2) DEFAULT NULL,
  `creado_en` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id_metrica`),
  KEY `idx_fecha_tipo` (`fecha`,`tipo_metrica`),
  KEY `idx_categoria` (`categoria`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_spanish2_ci;

